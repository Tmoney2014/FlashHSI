<UserControl x:Class="FlashHSI.UI.Views.Pages.SettingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:system="clr-namespace:System;assembly=System.Runtime"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
              xmlns:behaviors="clr-namespace:FlashHSI.UI.Behaviors"
              xmlns:converters="clr-namespace:FlashHSI.UI.Converters"
              mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="1000">
    
    <UserControl.Resources>
        <system:Double x:Key="TabControlWidth">160</system:Double>
        <converters:HexToColorBrushConverter x:Key="HexToColorBrushConverter"/>
    </UserControl.Resources>

    <Grid Background="{DynamicResource MaterialDesignPaper}">
        <TabControl TabStripPlacement="Left"
                    Style="{StaticResource MaterialDesignNavigationRailTabControl}"
                    materialDesign:ColorZoneAssist.Mode="PrimaryMid"
                    materialDesign:NavigationRailAssist.ShowSelectionBackground="True"
                    materialDesign:NavigationRailAssist.SelectionCornerRadius="5">
            
            <!-- 1. CAMERA TAB -->
            <TabItem Width="{StaticResource TabControlWidth}" Height="60">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Camera" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Camera" VerticalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                </TabItem.Header>
                
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel MaxWidth="1200" HorizontalAlignment="Stretch">
                        <TextBlock Text="Camera Settings" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,20"/>
                        
                        <!-- Connection / Params -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Parameters" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Exposure Time (Î¼s)" Width="180" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding CameraExposureTime, StringFormat=N0}" Width="60" DockPanel.Dock="Right" TextAlignment="Right"/>
                                    <Slider Minimum="100" Maximum="10000" Value="{Binding CameraExposureTime}" TickFrequency="100" IsSnapToTickEnabled="False"/>
                                </DockPanel>
                                <DockPanel>
                                    <TextBlock Text="Acquisition FPS" Width="180" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding CameraFrameRate, StringFormat=N0}" Width="60" DockPanel.Dock="Right" TextAlignment="Right"/>
                                    <Slider Minimum="1" Maximum="700" Value="{Binding CameraFrameRate}" TickFrequency="10" IsSnapToTickEnabled="False"/>
                                </DockPanel>
                            </StackPanel>
                        </materialDesign:Card>
                        
                        <!-- References -->
                        <!-- AIê°€ ìˆ˜ì •í•¨: ë ˆí¼ëŸ°ìŠ¤ ê²½ë¡œ í‘œì‹œ ë° ìƒíƒœ ì•„ì´ì½˜ ì¶”ê°€ -->
                        <materialDesign:Card Padding="16">
                            <StackPanel>
                                <TextBlock Text="Calibration References" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                
                                <!-- White Reference -->
                                <TextBlock Text="White Reference" FontWeight="Medium" Margin="0,0,0,6"/>
                                <DockPanel Margin="0,0,0,4">
                                    <!-- ìƒíƒœ ì•„ì´ì½˜ -->
                                    <materialDesign:PackIcon DockPanel.Dock="Left" Width="20" Height="20" VerticalAlignment="Center" Margin="0,0,8,0">
                                        <materialDesign:PackIcon.Style>
                                            <Style TargetType="materialDesign:PackIcon">
                                                <Setter Property="Kind" Value="CloseCircle"/>
                                                <Setter Property="Foreground" Value="#F44336"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsWhiteRefLoaded}" Value="True">
                                                        <Setter Property="Kind" Value="CheckCircle"/>
                                                        <Setter Property="Foreground" Value="#4CAF50"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </materialDesign:PackIcon.Style>
                                    </materialDesign:PackIcon>
                                    <!-- ë¡œë“œ ë²„íŠ¼ -->
                                    <Button DockPanel.Dock="Right" Command="{Binding LoadWhiteRefCommand}" Content="Load" 
                                            Style="{StaticResource MaterialDesignOutlinedButton}" 
                                            Height="30" Padding="12,0" Margin="8,0,0,0"/>
                                    <!-- íŒŒì¼ ê²½ë¡œ í‘œì‹œ -->
                                    <TextBox Text="{Binding WhiteRefPath, Mode=OneWay}" IsReadOnly="True" 
                                             VerticalAlignment="Center"
                                             materialDesign:HintAssist.Hint="íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             FontSize="12" Height="30" Padding="4,4"/>
                                </DockPanel>
                                
                                <Separator Margin="0,12"/>
                                
                                <!-- Dark Reference -->
                                <TextBlock Text="Dark Reference" FontWeight="Medium" Margin="0,12,0,6"/>
                                <DockPanel Margin="0,0,0,0">
                                    <!-- ìƒíƒœ ì•„ì´ì½˜ -->
                                    <materialDesign:PackIcon DockPanel.Dock="Left" Width="20" Height="20" VerticalAlignment="Center" Margin="0,0,8,0">
                                        <materialDesign:PackIcon.Style>
                                            <Style TargetType="materialDesign:PackIcon">
                                                <Setter Property="Kind" Value="CloseCircle"/>
                                                <Setter Property="Foreground" Value="#F44336"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDarkRefLoaded}" Value="True">
                                                        <Setter Property="Kind" Value="CheckCircle"/>
                                                        <Setter Property="Foreground" Value="#4CAF50"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </materialDesign:PackIcon.Style>
                                    </materialDesign:PackIcon>
                                    <!-- ë¡œë“œ ë²„íŠ¼ -->
                                    <Button DockPanel.Dock="Right" Command="{Binding LoadDarkRefCommand}" Content="Load" 
                                            Style="{StaticResource MaterialDesignOutlinedButton}" 
                                            Height="30" Padding="12,0" Margin="8,0,0,0"/>
                                    <!-- íŒŒì¼ ê²½ë¡œ í‘œì‹œ -->
                                    <TextBox Text="{Binding DarkRefPath, Mode=OneWay}" IsReadOnly="True" 
                                             VerticalAlignment="Center"
                                             materialDesign:HintAssist.Hint="íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             FontSize="12" Height="30" Padding="4,4"/>
                                </DockPanel>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 2. AIR GUN TAB (Injection) -->
            <TabItem Width="{StaticResource TabControlWidth}" Height="60">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AirFilter" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Air Gun" VerticalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                </TabItem.Header>

                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel MaxWidth="1200" HorizontalAlignment="Stretch">
                        <TextBlock Text="Ejection &amp; Tracking" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,20"/>
                        
                        <!-- AIê°€ ì¶”ê°€í•¨: EtherCAT ì—°ê²° ì¹´ë“œ -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="EtherCAT ì—°ê²°" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                
                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Network Interface" Width="180" VerticalAlignment="Center"/>
                                    <Button Content="â†»" Command="{Binding RefreshNetworkInterfacesCommand}" 
                                            Style="{StaticResource MaterialDesignIconButton}" DockPanel.Dock="Right" Width="32" Height="32" ToolTip="ìƒˆë¡œê³ ì¹¨"/>
                                    <ComboBox ItemsSource="{Binding NetworkInterfaces}" SelectedItem="{Binding SelectedNetworkInterface}"/>
                                </DockPanel>
                                
                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Cycle Frequency (Hz)" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding EtherCATCycleFrequency}" Width="80" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="100" Maximum="2000" Value="{Binding EtherCATCycleFrequency}" TickFrequency="100" IsSnapToTickEnabled="True"/>
                                </DockPanel>

                                <DockPanel Margin="0,0,0,10" ToolTip="ì¹´ë©”ë¼ ì‹œì•¼í­(mm). 0ì´ë©´ ë‹¨ìˆœ í”½ì…€â†’ì±„ë„ ë§¤í•‘">
                                    <TextBlock Text="Field of View (mm)" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding FieldOfView}" Width="80" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="0" Maximum="2000" Value="{Binding FieldOfView}" TickFrequency="10" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                                
                                <CheckBox Content="Channel Reverse (ì±„ë„ ë°˜ì „)" IsChecked="{Binding IsChannelReverse}" Margin="0,0,0,10"/>

                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions><ColumnDefinition/><ColumnDefinition/></Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Command="{Binding ConnectEtherCATCommand}" Content="Connect" Margin="0,0,8,0"
                                            Style="{StaticResource MaterialDesignRaisedButton}"/>
                                    <Button Grid.Column="1" Command="{Binding DisconnectEtherCATCommand}" Content="Disconnect" Margin="8,0,0,0"
                                            Style="{StaticResource MaterialDesignOutlinedButton}"/>
                                </Grid>
                                
                                <TextBlock Text="{Binding AirGunStatusText}" Margin="0,8,0,0" Foreground="Gray" FontSize="12"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- AIê°€ ì¶”ê°€í•¨: Master Control ì¹´ë“œ -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Master Control" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                <DockPanel>
                                    <TextBlock Text="Master ON/OFF" Width="180" VerticalAlignment="Center"/>
                                    <ToggleButton IsChecked="{Binding IsMasterOn}" Command="{Binding ToggleMasterCommand}"
                                                  Style="{StaticResource MaterialDesignSwitchToggleButton}" DockPanel.Dock="Right"/>
                                </DockPanel>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- AIê°€ ì¶”ê°€í•¨: Air Gun Test ì¹´ë“œ -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Air Gun Test" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                
                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Start Channel" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding TestStartChannel}" Width="80" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="1" Maximum="128" Value="{Binding TestStartChannel}" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Blow Time (ms)" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding TestBlowTime}" Width="80" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="10" Maximum="500" Value="{Binding TestBlowTime}" TickFrequency="10" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Delay Between (ms)" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding TestDelay}" Width="80" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="50" Maximum="2000" Value="{Binding TestDelay}" TickFrequency="50" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                                
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions><ColumnDefinition/><ColumnDefinition/></Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Command="{Binding TestAllChannelsCommand}" Content="Test All Channels" Margin="0,0,8,0"
                                            Style="{StaticResource MaterialDesignRaisedButton}"/>
                                    <Button Grid.Column="1" Command="{Binding CancelTestAllChannelsCommand}" Content="Cancel Test" Margin="8,0,0,0"
                                            Style="{StaticResource MaterialDesignOutlinedButton}"/>
                                </Grid>
                                
                                <Separator Margin="0,16"/>
                                
                                <TextBlock Text="Single Channel Test" FontWeight="Bold" Margin="0,0,0,10"/>
                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Channel" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding TestSingleChannel}" Width="80" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="1" Maximum="128" Value="{Binding TestSingleChannel}" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                                <Button Command="{Binding TestSingleChannelCommand}" Content="Fire Single Channel"
                                        Style="{StaticResource MaterialDesignOutlinedButton}" HorizontalAlignment="Left"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- AIê°€ ì¶”ê°€í•¨: ë¹„ìƒ ì •ì§€ ì¹´ë“œ -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16" Background="#B71C1C">
                            <Button Command="{Binding EmergencyStopCommand}" 
                                    Content="EMERGENCY STOP" 
                                    FontSize="18" FontWeight="Bold"
                                    Foreground="White" Background="#D32F2F" BorderBrush="#D32F2F"
                                    Height="50"
                                    HorizontalAlignment="Stretch"
                                    Style="{StaticResource MaterialDesignRaisedButton}"/>
                        </materialDesign:Card>

                        <!-- Ejection Logic -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="ðŸ”« Ejection Parameters" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                
                                <DockPanel Margin="0,0,0,10" ToolTip="Detection to Fire Delay (Legacy BlowDelay)">
                                    <TextBlock Text="Base Delay (ms)" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding EjectionDelayMs}" Width="50" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="0" Maximum="500" Value="{Binding EjectionDelayMs}" TickFrequency="10" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                                
                                <!-- Y-Based Correction Rules -->
                                <materialDesign:Card Margin="0,0,0,10" Padding="8">
                                    <StackPanel>
                                        <DockPanel Margin="0,0,0,8">
                                            <TextBlock Text="Y-Correction Rules (Delay Offset)" VerticalAlignment="Center" FontWeight="Bold"/>
                                            <Button Command="{Binding AddYCorrectionRuleCommand}" Content="Add Rule" 
                                                    Style="{StaticResource MaterialDesignFlatButton}" 
                                                    Foreground="White"
                                                    Height="24" Padding="8,0" FontSize="10" 
                                                    DockPanel.Dock="Right"/>
                                        </DockPanel>
                                        
                                        <ItemsControl ItemsSource="{Binding YCorrectionRules}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <materialDesign:Card Margin="0,0,0,8" Padding="8">
                                                        <StackPanel>
                                                            <!-- Rule Header: Description or Index & Delete Button -->
                                                            <DockPanel Margin="0,0,0,4">
                                                                <TextBlock Text="Rule" VerticalAlignment="Center" Foreground="Gray" FontSize="10"/>
                                                                <Button Command="{Binding DataContext.RemoveYCorrectionRuleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                                        CommandParameter="{Binding}"
                                                                        Style="{StaticResource MaterialDesignIconForegroundButton}"
                                                                        Width="20" Height="20"
                                                                        HorizontalAlignment="Right"
                                                                        DockPanel.Dock="Right"
                                                                        ToolTip="Remove Rule">
                                                                    <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                                                                </Button>
                                                            </DockPanel>

                                                            <DockPanel Margin="0,0,0,4">
                                                                <TextBlock Text="Threshold Y (Px)" VerticalAlignment="Center" Width="100"/>
                                                                <TextBlock Text="{Binding ThresholdY, StringFormat=N0}" Width="60" DockPanel.Dock="Right" TextAlignment="Right"/>
                                                                
                                                                <!-- Y Threshold Slider (0~1024px) -->
                                                                <Slider Minimum="0" Maximum="1024" Value="{Binding ThresholdY}" TickFrequency="10" IsSnapToTickEnabled="True">
                                                                    <i:Interaction.Triggers>
                                                                        <i:EventTrigger EventName="DragCompleted">
                                                                            <i:InvokeCommandAction Command="{Binding DataContext.SaveYCorrectionRulesCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                                                        </i:EventTrigger>
                                                                    </i:Interaction.Triggers>
                                                                </Slider>
                                                            </DockPanel>

                                                            <DockPanel>
                                                                <TextBlock Text="Correction (ms)" VerticalAlignment="Center" Width="100"/>
                                                                <TextBlock Text="{Binding CorrectionMs, StringFormat=N0}" Width="60" DockPanel.Dock="Right" TextAlignment="Right"/>
                                                                
                                                                <!-- Correction Ms Slider (-20 ~ 20ms) -->
                                                                <Slider Minimum="-20" Maximum="20" Value="{Binding CorrectionMs}" TickFrequency="1" IsSnapToTickEnabled="True">
                                                                    <i:Interaction.Triggers>
                                                                        <i:EventTrigger EventName="DragCompleted">
                                                                            <i:InvokeCommandAction Command="{Binding DataContext.SaveYCorrectionRulesCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                                                        </i:EventTrigger>
                                                                    </i:Interaction.Triggers>
                                                                </Slider>
                                                            </DockPanel>
                                                        </StackPanel>
                                                    </materialDesign:Card>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </materialDesign:Card>
                                
                                <DockPanel Margin="0,0,0,10" ToolTip="Valve Open Duration (Fixed)">
                                    <TextBlock Text="Duration (ms)" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding EjectionDurationMs}" Width="50" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="5" Maximum="200" Value="{Binding EjectionDurationMs}" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                                
                                <DockPanel Margin="0,0,0,0" ToolTip="Number of extra valves to fire around center (0 = Center only)">
                                    <TextBlock Text="Blow Margin (Valves)" Width="180" VerticalAlignment="Center" Foreground="White"/>
                                    <TextBox Text="{Binding EjectionBlowMargin}" Width="50" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="0" Maximum="5" Value="{Binding EjectionBlowMargin}" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Blob Tracking -->
                        <materialDesign:Card Padding="16">
                            <StackPanel>
                                <TextBlock Text="ðŸ”µ Object Tracking (Blob)" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>

                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Min Size (Pixels)" Width="180" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding BlobMinPixels}" Width="40" DockPanel.Dock="Right" TextAlignment="Right"/>
                                    <Slider Minimum="1" Maximum="100" Value="{Binding BlobMinPixels}" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                </DockPanel>

                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Max Line Gap" Width="180" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding BlobLineGap}" Width="40" DockPanel.Dock="Right" TextAlignment="Right"/>
                                    <Slider Minimum="0" Maximum="50" Value="{Binding BlobLineGap}" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                </DockPanel>

                                <DockPanel Margin="0,0,0,0">
                                    <TextBlock Text="Pixel Gap (X)" Width="180" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding BlobPixelGap}" Width="40" DockPanel.Dock="Right" TextAlignment="Right"/>
                                    <Slider Minimum="0" Maximum="50" Value="{Binding BlobPixelGap}" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 3. FEEDER TAB -->
            <!-- AIê°€ ìž‘ì„±í•¨: í”¼ë” ì œì–´ íƒ­ ì „ì²´ êµ¬í˜„ -->
            <TabItem Width="{StaticResource TabControlWidth}" Height="60">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Factory" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Feeder" VerticalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                </TabItem.Header>

                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel MaxWidth="1200" HorizontalAlignment="Stretch">
                        <TextBlock Text="Feeder Control" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,20"/>

                        <!-- ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ì¹´ë“œ -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Serial Port ì—°ê²°" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>

                                <DockPanel Margin="0,0,0,10">
                                    <TextBlock Text="Serial Port" Width="180" VerticalAlignment="Center"/>
                                    <Button Content="â†»" Command="{Binding RefreshSerialPortsCommand}" 
                                            Style="{StaticResource MaterialDesignIconButton}" DockPanel.Dock="Right" Width="32" Height="32" ToolTip="ìƒˆë¡œê³ ì¹¨"/>
                                    <ComboBox ItemsSource="{Binding AvailableSerialPorts}" SelectedItem="{Binding SelectedSerialPort}"/>
                                </DockPanel>

                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions><ColumnDefinition/><ColumnDefinition/></Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Command="{Binding ConnectSerialPortCommand}" Content="Connect" Margin="0,0,8,0"
                                            Style="{StaticResource MaterialDesignRaisedButton}"/>
                                    <!-- DisconnectëŠ” ShutDown ë©”ì„œë“œê°€ í•„ìš”í•˜ë‚˜ í˜„ìž¬ UIì—ì„œ í•„ìš” ì‹œ ì¶”ê°€ ê°€ëŠ¥ -->
                                    <TextBlock Grid.Column="1" Text="{Binding FeederStatusText}" VerticalAlignment="Center" Foreground="Gray" FontSize="12" Margin="8,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- í”¼ë” ê°œìˆ˜ ì„¤ì • ì¹´ë“œ -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Feeder Count" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                <DockPanel>
                                    <TextBlock Text="í”¼ë” ê°œìˆ˜ (0~9)" Width="180" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding FeederCount}" Width="80" DockPanel.Dock="Right" TextAlignment="Right"
                                             behaviors:NumericOnlyBehavior.IsEnabled="True"/>
                                    <Slider Minimum="0" Maximum="9" Value="{Binding FeederCount}" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- í”¼ë” ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- ì œëª© -->
                                <TextBlock Grid.Row="0" Text="Feeder Output" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>

                                <!-- êµ¬ë¶„ì„  -->
                                <Border Grid.Row="1" Height="1" Background="{DynamicResource MaterialDesign.Brush.Divider}" Margin="0,0,0,16"/>

                                <!-- ê°œë³„ í”¼ë” ë¦¬ìŠ¤íŠ¸ -->
                                <ItemsControl Grid.Row="2" ItemsSource="{Binding FeederList}" Margin="0,0,0,16">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <materialDesign:Card Margin="0,0,0,8" Padding="12">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="32"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="32"/>
                                                        <ColumnDefinition Width="50"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- í”¼ë” ë²ˆí˜¸ -->
                                                    <TextBlock Grid.Column="0" VerticalAlignment="Center" FontSize="14" FontWeight="Medium">
                                                        <Run Text="{Binding DisplayNumber, Mode=OneWay}"/>
                                                        <Run Text="ë²ˆ í”¼ë”"/>
                                                    </TextBlock>

                                                    <!-- ê°ì†Œ ë²„íŠ¼ -->
                                                    <Button Grid.Column="1"
                                                            Command="{Binding DataContext.DecreaseFeederValueCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            Width="28" Height="28" VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="Minus" Width="16" Height="16"/>
                                                    </Button>

                                                    <!-- ìŠ¬ë¼ì´ë” -->
                                                    <Slider Grid.Column="2" Margin="8,0"
                                                            Minimum="1" Maximum="99"
                                                            Value="{Binding FeederValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                            TickFrequency="10" TickPlacement="None" IsSnapToTickEnabled="False"
                                                            VerticalAlignment="Center">
                                                        <i:Interaction.Behaviors>
                                                            <behaviors:SliderDragCompletedBehavior
                                                                Command="{Binding DataContext.FeederSliderDragCompletedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                CommandParameter="{Binding}"/>
                                                        </i:Interaction.Behaviors>
                                                    </Slider>

                                                    <!-- ì¦ê°€ ë²„íŠ¼ -->
                                                    <Button Grid.Column="3"
                                                            Command="{Binding DataContext.IncreaseFeederValueCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            Width="28" Height="28" VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="Plus" Width="16" Height="16"/>
                                                    </Button>

                                                    <!-- ê°’ ë°°ì§€ -->
                                                    <Border Grid.Column="4"
                                                            Background="{DynamicResource MaterialDesign.Brush.Primary}"
                                                            CornerRadius="12" Padding="8,4"
                                                            VerticalAlignment="Center" HorizontalAlignment="Center">
                                                        <TextBlock Text="{Binding FeederValue, StringFormat='{}{0}'}"
                                                                   FontSize="14" FontWeight="Bold" Foreground="White"
                                                                   HorizontalAlignment="Center"/>
                                                    </Border>
                                                </Grid>
                                            </materialDesign:Card>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ì „ì²´ ì œì–´ í–‰ -->
                                <materialDesign:Card Grid.Row="3" Padding="12"
                                                     Background="{DynamicResource MaterialDesign.Brush.Secondary.Light}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="32"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="32"/>
                                            <ColumnDefinition Width="50"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="ì „ì²´ ì œì–´" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>

                                        <Button Grid.Column="1" Command="{Binding DecreaseAllFeederValueCommand}"
                                                Style="{StaticResource MaterialDesignIconButton}"
                                                Width="28" Height="28" VerticalAlignment="Center">
                                            <materialDesign:PackIcon Kind="Minus" Width="16" Height="16"/>
                                        </Button>

                                        <Slider Grid.Column="2" Margin="8,0"
                                                Minimum="1" Maximum="99"
                                                Value="{Binding AllFeederValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                TickFrequency="10" TickPlacement="None" IsSnapToTickEnabled="False"
                                                VerticalAlignment="Center">
                                            <i:Interaction.Behaviors>
                                                <behaviors:SliderDragCompletedBehavior
                                                    Command="{Binding FeederSliderDragCompletedCommand}"
                                                    CommandParameter="AllFeederValue"/>
                                            </i:Interaction.Behaviors>
                                        </Slider>

                                        <Button Grid.Column="3" Command="{Binding IncreaseAllFeederValueCommand}"
                                                Style="{StaticResource MaterialDesignIconButton}"
                                                Width="28" Height="28" VerticalAlignment="Center">
                                            <materialDesign:PackIcon Kind="Plus" Width="16" Height="16"/>
                                        </Button>

                                        <Border Grid.Column="4"
                                                Background="{DynamicResource MaterialDesign.Brush.Primary}"
                                                CornerRadius="12" Padding="8,4"
                                                VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <TextBlock Text="{Binding AllFeederValue, StringFormat='{}{0}'}"
                                                       FontSize="14" FontWeight="Bold" Foreground="White"
                                                       HorizontalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                </materialDesign:Card>
                            </Grid>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 4. RECIPE TAB -->
            <!-- AIê°€ ìž‘ì„±í•¨: ë¶„ë¥˜ í´ëž˜ìŠ¤ ì„ íƒ (ì—ì–´ê±´ íƒ€ê²Ÿ) íƒ­ -->
            <TabItem Width="{StaticResource TabControlWidth}" Height="60">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="FormatListBulletedSquare" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Recipe" VerticalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                </TabItem.Header>

                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel MaxWidth="1200" HorizontalAlignment="Stretch">
                        <TextBlock Text="Sort Class Selection" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,20"/>

                        <!-- ì—ì–´ê±´ íƒ€ê²Ÿ í´ëž˜ìŠ¤ ì¹´ë“œ -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="ì—ì–´ê±´ íƒ€ê²Ÿ í´ëž˜ìŠ¤" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>

                                <!-- ì „ì²´ ì„ íƒ/í•´ì œ ë²„íŠ¼ -->
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions><ColumnDefinition/><ColumnDefinition/></Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Command="{Binding SelectAllSortClassesCommand}" Content="ì „ì²´ ì„ íƒ" Margin="0,0,8,0"
                                            Style="{StaticResource MaterialDesignRaisedButton}"/>
                                    <Button Grid.Column="1" Command="{Binding DeselectAllSortClassesCommand}" Content="ì „ì²´ í•´ì œ" Margin="8,0,0,0"
                                            Style="{StaticResource MaterialDesignOutlinedButton}"/>
                                </Grid>

                                <!-- í´ëž˜ìŠ¤ ë¦¬ìŠ¤íŠ¸ -->
                                <ItemsControl ItemsSource="{Binding SortClasses}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <materialDesign:Card Margin="0,0,0,8" Padding="12">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="8"/>
                                                        <ColumnDefinition Width="12"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- í´ëž˜ìŠ¤ ìƒ‰ìƒ í‘œì‹œ -->
                                                    <Border Grid.Column="0" Width="8" CornerRadius="4"
                                                            Background="{Binding ColorHex, Converter={StaticResource HexToColorBrushConverter}}"
                                                            VerticalAlignment="Stretch"/>

                                                    <!-- í´ëž˜ìŠ¤ ì´ë¦„ -->
                                                    <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                                        <TextBlock FontSize="14" FontWeight="Medium">
                                                            <Run Text="{Binding Name, Mode=OneWay}"/>
                                                        </TextBlock>
                                                        <TextBlock FontSize="11" Foreground="Gray">
                                                            <Run Text="Class"/>
                                                            <Run Text="{Binding Index, Mode=OneWay}"/>
                                                        </TextBlock>
                                                    </StackPanel>

                                                    <!-- ì„ íƒ í† ê¸€ -->
                                                    <ToggleButton Grid.Column="3"
                                                                  IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                  Style="{StaticResource MaterialDesignSwitchToggleButton}"
                                                                  VerticalAlignment="Center"/>
                                                </Grid>
                                            </materialDesign:Card>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ëª¨ë¸ ë¯¸ë¡œë“œ ì•ˆë‚´ -->
                                <TextBlock Text="ëª¨ë¸ì„ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”." 
                                           Foreground="Gray" FontSize="14" 
                                           HorizontalAlignment="Center" Margin="0,20,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SortClasses.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 5. FILE PATH TAB -->
            <TabItem Width="{StaticResource TabControlWidth}" Height="60">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Folder" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="File Path" VerticalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                </TabItem.Header>

                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel MaxWidth="1200" HorizontalAlignment="Left">
                        <TextBlock Text="Paths &amp; Models" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,20"/>
                        
                        <materialDesign:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="HSI Model" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                <Button Command="{Binding LoadModelCommand}" Content="Load Model JSON" Margin="0,0,0,8" HorizontalAlignment="Left"/>
                                
                                <Separator Margin="0,16"/>
                                
                                <TextBlock Text="Simulation Data" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                <Button Command="{Binding SelectDataFileCommand}" Content="Select ENVI Header (*.hdr)" Style="{StaticResource MaterialDesignOutlinedButton}" HorizontalAlignment="Left"/>
                                <TextBlock Text="{Binding HeaderPath}" Margin="0,8,0,0" TextWrapping="Wrap" Foreground="Gray"/>
                            </StackPanel>
                        </materialDesign:Card>
                        
                        <materialDesign:Card Padding="16">
                            <StackPanel>
                                <TextBlock Text="Target FPS (Sim Only)" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                                <DockPanel>
                                    <TextBlock Text="Target FPS" Width="180"/>
                                    <TextBlock Text="{Binding TargetFps, StringFormat=N0}" Width="40" DockPanel.Dock="Right" TextAlignment="Right"/>
                                    <Slider Minimum="10" Maximum="1000" Value="{Binding TargetFps}" TickFrequency="10" IsSnapToTickEnabled="True"/>
                                </DockPanel>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 6. LANGUAGE TAB -->
            <TabItem Width="{StaticResource TabControlWidth}" Height="60">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Translate" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Language" VerticalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                </TabItem.Header>
                <Grid>
                    <TextBlock Text="Language Settings (Coming Soon)" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Gray" FontSize="20"/>
                </Grid>
            </TabItem>

        </TabControl>
    </Grid>
</UserControl>
